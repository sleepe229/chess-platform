# Server
server.port=8080

# Application
spring.application.name=chess-api-gateway

# Redis for Rate Limiting
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0

# Cloud Gateway - Default Filters
spring.cloud.gateway.default-filters[0].name=RequestRateLimiter
spring.cloud.gateway.default-filters[0].args.redis-rate-limiter.replenishRate=60
spring.cloud.gateway.default-filters[0].args.redis-rate-limiter.burstCapacity=100
spring.cloud.gateway.default-filters[0].args.redis-rate-limiter.requestedTokens=1


# CORS Configuration
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedOrigins[0]=http://localhost:3000
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedOrigins[1]=http://localhost:8080
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods[0]=GET
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods[1]=POST
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods[2]=PUT
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods[3]=DELETE
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods[4]=PATCH
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods[5]=OPTIONS
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedHeaders=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].exposedHeaders[0]=X-Request-Id
spring.cloud.gateway.globalcors.cors-configurations.[/**].exposedHeaders[1]=X-Total-Count
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowCredentials=true
spring.cloud.gateway.globalcors.cors-configurations.[/**].maxAge=3600

# JWT Configuration
# JWT_SECRET must be provided as environment variable (minimum 32 characters)
jwt.secret=${JWT_SECRET}
jwt.access-token-validity-ms=${JWT_ACCESS_TOKEN_VALIDITY_MS:900000}
jwt.refresh-token-validity-ms=${JWT_REFRESH_TOKEN_VALIDITY_MS:2592000000}

# Circuit Breaker Configuration
resilience4j.circuitbreaker.configs.default.slidingWindowSize=10
resilience4j.circuitbreaker.configs.default.minimumNumberOfCalls=5
resilience4j.circuitbreaker.configs.default.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.configs.default.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.configs.default.waitDurationInOpenState=10s
resilience4j.circuitbreaker.configs.default.failureRateThreshold=50
resilience4j.circuitbreaker.configs.default.slowCallRateThreshold=100
resilience4j.circuitbreaker.configs.default.slowCallDurationThreshold=2s

# Management & Monitoring
management.endpoints.web.exposure.include=health,info,prometheus,metrics,circuitbreakers,circuitbreakerevents
management.endpoint.health.show-details=when-authorized
management.prometheus.metrics.export.enabled=true
management.metrics.tags.application=${spring.application.name}

# Logging
logging.level.root=INFO
logging.level.com.chess.gateway=DEBUG
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.security=DEBUG
logging.pattern.console=%clr(%d{yyyy-MM-dd HH:mm:ss}){faint} %clr(%5p) %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n
