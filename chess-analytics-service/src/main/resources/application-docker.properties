server.port=8086
spring.application.name=chess-analytics-service

# Datasource (PostgreSQL)
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://${DB_HOST:postgres}:${DB_PORT:5432}/${DB_NAME:chess_analytics}}
spring.datasource.username=${DB_USER:postgres}
spring.datasource.password=${DB_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.default_schema=chess_analytics
spring.jpa.defer-datasource-initialization=false

# Flyway
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.schemas=chess_analytics
spring.flyway.create-schemas=true
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true

jwt.secret=${JWT_SECRET}

nats.enabled=${NATS_ENABLED:true}
nats.url=${NATS_URL}

# ProcessedEventStore: redis (shared when scaled) or in-memory for single instance
analytics.processed-event-store.type=${ANALYTICS_PROCESSED_EVENT_STORE_TYPE:redis}
# When using redis, our RedisProcessedEventStoreConfig creates the connection; exclude auto-config to allow inmemory when no Redis
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
spring.data.redis.host=${SPRING_DATA_REDIS_HOST:redis}
spring.data.redis.port=${SPRING_DATA_REDIS_PORT:6379}

logging.level.root=INFO
logging.level.com.chess.analytics=DEBUG
logging.level.org.flywaydb=DEBUG

management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.show-details=always
management.prometheus.metrics.export.enabled=true
